# 1.前言
1. chess-ai-frontend文件夹是前端整个项目，是使用vite构建的vue3项目，里面的脚本语言选择ts，通过Axios向后端发送http请求。
2. 在开发前端项目的过程中，为了对前后端对接进行测试，本人制作了一个模拟后端，在flaskProject文件夹的backend_mock.py文件中。该后端仅本人在开发过程中做测试，里面的ai走法都是一些写死的数据，因此可以无视该文件夹。如果实在感兴趣，在该文件夹下使用python backend_mock.py即可运行模拟后端，不要在pycharm等IDE中直接点那个播放按钮运行，不然它的端口号是对不上的。
3. 在部署前端前可以看一下本人录制的**象棋前端演示.mp4**，里面演示了前端可能遇到的各种效果。
4. 请务必把整个README文档全阅读一遍再进行前后端对接。

# 2.部署相关
## 2.1 开发&测试环境
1. 在运行前端环境时，确保已经安装了Node.js（推荐LTS版本）和相应的npm。如果读者之前上过一些前端相关的课程（如vue、微信小程序），大概率电脑已经安装了。如果实在没安装，可上网搜索相关教程，并无太大难度。
2. 将chess-ai-frontend文件夹拖到vscode打开，在终端输入`npm run dev`即可启动项目
3. 启动成功后，浏览器输入`http://localhost:7070`即可访问前端页面 (端口号可在 `vite.config.ts` 中修改)。
4. 默认请求的后端接口是`http://127.0.0.1:8080`，同样可在 `vite.config.ts` 中修改


## 2.2 生产环境
1. 鉴于课件上推荐使用docker部署，可把前端的文件夹传到Linux上，编写Dockerfile进行部署。具体怎么编写Dockerfile本人也不太熟悉，建议问ai或查询相关教学文章。可以从以下视频的P57看起： [尚硅谷Docker实战教程（docker教程天花板）\_哔哩哔哩\_bilibili](https://www.bilibili.com/video/BV1gr4y1U7CY/?spm_id_from=333.337.search-card.all.click&vd_source=00195baa57b330aeec77a6e5836f7da7) 
2. 根据ai的描述，当使用docker部署时，代理后端端口号的那行代码似乎无效，如果的确如此且难以解决，可用docker部署一个nginx，在其配置文件中设置全局动态代理使前端能够正确访问到后端。具体怎么操作本人也不熟练，建议问ai，而且用了nginx后，代码跟后端端口号相关的代码估计也得改一下，比如把发送请求的端口号发给80（nginx的默认端口号）。



![相关图片](2025-06-07_232017.png)

# 3.前端主要文件说明
如果前端相关功能或者前后端联调遇到什么问题，只用把以下四个文件的内容丢给ai即可。其它文件都是vite构建时产生的，没必要动它们。
## 3.1 App.vue和ChessBoard.vue
* **App.vue**:
    - **位置**: src/App.vue
    - **主要职责**: 整体游戏逻辑控制、状态管理 (当前行棋方、棋子数据、游戏结束状态等)、与后端API的交互 (requestAIMove 方法)、处理玩家和AI的走法 (handlePlayerMove, applyAIMove 方法)。
    - **API URL 配置**: 在此文件的 `<script setup>` 部分，API_BASE_URL 变量控制API请求的基础路径。默认为 /api (配合Vite代理或生产环境Nginx反向代理)。
- **ChessBoard.vue**:
    - **位置**: src/components/ChessBoard.vue
    - **主要职责**: 负责棋盘和棋子的绘制 (使用HTML Canvas)、处理用户在棋盘上的点击事件、校验走法是否符合象棋规则 (validateMove 方法以及内部的 rule_棋子名 系列方法)。
    - **象棋规则实现**: 所有的象棋基本移动规则（车、马、相、士、将、炮、兵/卒的走法，包括蹩马腿、塞象眼、九宫格限制、兵卒过河规则、炮的隔山打牛等）都在此组件内实现。

## 3.2 types.ts
- **位置**: src/types.ts
- **主要职责**: 定义了项目中使用的 TypeScript 类型和接口，例如 Piece (棋子对象)、AISuggestionResponseSimple (后端API响应)。
- 后端在设计响应时，可以参考 **AISuggestionResponseSimple 接口**（该接口所定义的数据类型即后端JSON响应体所对应的格式，其中code和data属性是后端必须传给前端的）。

## 3.3 vite.config.ts
- **位置**: 项目根目录
- **主要职责**: 主要定义了前端服务器的端口号（7070），以及对/api为前缀的请求代理发送到后端服务器（8080）
- **开发服务器代理**: 包含 server.proxy 配置，用于在**开发环境**下将前端发往 /api 的请求代理到本地运行的后端服务 (默认为 [http://127.0.0.1:8080](http://127.0.0.1:8080))，以解决跨域问题。
如果后端开发时运行在不同的端口或主机，请修改此处的 target。**此代理配置在生产构建 (npm run build) 时无效。** 生产环境得用nginx转发请求

# 4.前后端对接相关
## 4.1 api接口
- **功能**: 请求AI给出当前棋局的下一步建议走法。
- **请求类型**: `GET` 
- **URL**: `/api/suggest/{currentBoardString}`

## 4.2 请求和响应的相关格式
### (1)请求
- **URL**: `/api/suggest/{currentBoardString}`
- {currentBoardString}: **路径参数**。这是一个代表当前棋盘状态的**64字符长度的字符串**。
* 该字符串由32个两位数字组成，每两位数字代表一个棋子在棋盘上的位置 (0-indexed, "列行")。
相关的代码在App.vue的 `const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || '/api';` 和以下代码中
```vue
const response = await axios.get<AISuggestionResponseSimple>(`${API_BASE_URL}/suggest/${currentBoardString}`);
```

### (2)响应
前端期望后端返回以下格式的 JSON 数据：

```json
{
  "code": 200,
  "data": "7062"
}
```

或者在AI无法提供走法或出错时（尽量不要让后端报404）：

```json
{
  "code": 404,
  "data": null,
  "message": "AI没有可建议的走法"
}
```

- **code** (number, 必需参数):
    - 200: 表示成功获取到AI的有效走法。
    - 其他值 (例如 404 或自定义错误码): 表示AI无法提供走法或发生错误。
- **data** (string | null, 必需参数):
    - 当 code 为 200 时，data 应该是AI的走法字符串。
        - 格式为4位数字字符串："起始列起始行目标列目标行" (0-indexed)。
        - 例如："7062" 表示棋子从 (7列, 0行) 移动到 (6列, 2行)。
    - 当 code 不是 200 时，data 可以是 null 或一个空字符串。
- **message** (string, 可选参数):
    - 当 code 不是 200 时，可以提供一个描述性的错误或状态信息，前端会尝试显示它。

建议后端代码考虑一下健壮性，以**确保一定会返回一个正确的走法**，虽然前端作了相关兜底处理（后端报404或者走法不符合象棋规范时会忽视后端的走法，继续让用户走），但前端校验主要作为一层额外的保障或用于调试。如果AI频繁给出不合规走法，会影响用户体验。



# 5.前端功能细节
- **AI 走法成功 (code: 200, data: "走法字符串")**:
    1. 前端会尝试应用AI的走法。
    2. 在应用前，前端会**首先使用内置的象棋规则校验AI的走法是否合规** (ChessBoard.vue 中的 validateMove 方法)。
    3. **如果AI走法合规**: 棋子在棋盘上移动，轮到人类玩家走棋。
    4. **如果AI走法不合规**: 前端会在界面上提示 "AI走法不合规 (具体走法)，轮到您走棋"，并且AI的这一步会被跳过，行棋权直接交还给人类玩家。
- **AI 无法提供走法或后端错误 (code != 200 或 data 无效)**:
    1. 前端会在界面上显示后端返回的 message (如果提供) 或一个通用提示，例如 "AI无棋可走，轮到您走棋"。
    2. 行棋权会交还给人类玩家。
    3. **不会直接判定游戏胜负**，除非AI是被将死而无法走棋（这种情况需要后端AI逻辑判断并通过某种方式告知前端，当前模拟后端未实现此逻辑）。
- **请求AI接口失败 (网络错误等)**:
    1. 前端会显示 "请求AI走法失败，请检查网络或后端服务。轮到您走棋。"
    2. 行棋权会交还给人类玩家。
- **AI 走棋延迟**: 为了更好的用户体验，前端在收到AI走法后，会确保至少有2秒的思考时间（如果后端响应很快，会额外等待；如果后端响应本身就超过2秒，则直接显示）。